webpackJsonp([11],{HOjl:function(e,r,s){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=s("9TcC"),o={data:function(){return{fileList:[],file:{},fileDevice:{},fileDeviceList:[],picMasterVisible:!1,groupList:[],delList:[],mygroup:"",searchVal:"",form:{},rules:{userName:[{required:!0,message:"请输入姓名",trigger:"blur"}],userPhone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1(3|4|5|6|7|8)\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],userPassword:[{required:!0,message:"请输入姓名",trigger:"blur"}],userDeviceVersion:[{required:!0,message:"请输入软件版本号",trigger:"blur"}]}}},mounted:function(){this.getInfo(),this.getGroup()},methods:{getInfo:function(){var e=this;Object(t.c)().then(function(r){"200"==r.data.code&&(e.form=r.data.data,e.fileList=[{url:e.form.userLogoUrl}])})},changePack:function(){this.picMasterVisible=!0},submitPicForm:function(e){var r=this;this.$refs[e].validate(function(e){if(e){if(console.log(r.form.userLogoUrl),""==r.form.userLogoUrl)return r.$message({type:"error",message:"请选择头像!"}),!1;var s=new FormData;r.file?s.append("file",r.file.raw):s.append("file",r.form.userLogoUrl),s.append("userDeviceVersion",r.form.userDeviceVersion),s.append("userName",r.form.userName),s.append("userPassword",r.form.userPassword),s.append("userPhone",r.form.userPhone),Object(t.g)(s).then(function(e){200==e.data.code&&(r.$message({type:"success",message:"保存成功!"}),r.$router.push({name:"personalCenter"}))},function(e){r.$message({type:"error",message:"操作失败!"})})}})},getGroup:function(){var e=this,r={name:this.searchVal};Object(t.d)(r).then(function(r){200==r.data.code&&(e.groupList=r.data.data,e.$store.commit("setGroupLen",r.data.data.length))})},searchGroup:function(){this.getGroup()},addGroup:function(){var e=this;this.mygroup?Object(t.a)(this.mygroup).then(function(r){200==r.data.code&&(e.$message({type:"success",message:"操作成功!"}),e.mygroup="",
//! 添加或删除、修改后默认总组- 默认选择总组
e.$store.commit("setGroupId",999),e.getGroup())}):this.$message.warning("请输入需要添加的分组"),console.log(this.groupList)},inputBlur:function(e){var r=this,s={groupId:e.groupId,name:e.groupName};Object(t.f)(s).then(function(e){"200"==e.data.code&&(r.$message({type:"success",message:"修改成功!"}),r.getGroup(),
//! 添加或删除、修改后默认总组- 默认选择总组
r.$store.commit("setGroupId",999))})},delGroup:function(e){var r=this;this.$confirm("删除分组后，分组中的所有站点也将删除！确认删除？").then(function(s){Object(t.b)(e).then(function(e){"200"==e.data.code&&(r.$message({type:"success",message:"删除成功!"}),
//! 添加或删除、修改后默认总组- 默认选择总组
r.$store.commit("setGroupId",999),r.getGroup())})}).catch(function(e){})},handlePicRemove:function(){this.form.userLogoUrl="",this.file={}},beforePicUpload:function(e,r){var s=e.raw.type.split("/")[1],t=e.size/1024/1024;return-1===["jpeg","jpg","gif","png"].indexOf(s)?(this.$message.warning("上传图片格式错误"),r.splice(-1,1),!1):t>=400?(this.$message.warning("图片大小大于5M"),r.splice(-1,1),!1):(console.log("file",e),this.form.userLogoUrl=e.url,this.file=e,console.log(e),!0)},beforeDeviceUpload:function(e,r){return this.form.userDeviceUrl=e.url,this.fileDevice=e,console.log(this.fileDevice),!0},handleDeviceRemove:function(){this.form.userDeviceUrl="",this.fileDevice={}},beforeCloseDrawer:function(){this.form.userDeviceUrl="",this.fileDevice={},this.picMasterVisible=!1,this.fileDeviceList=[]},editCancle:function(e){1==e?(this.picMasterVisible=!1,this.form.userDeviceUrl="",this.fileDevice={},this.fileDeviceList=[]):this.$router.push({name:"personalCenter"})},save:function(e){var r=this;this.$refs[e].validate(function(e){if(e){if(""==r.form.userDeviceUrl)return r.$message({type:"error",message:"请上传设备软件包!"}),!1;var s=new FormData;r.fileDevice?s.append("file",r.fileDevice.raw):s.append("file",r.form.userDeviceUrl),s.append("userDeviceVersion",r.form.userDeviceVersion),s.append("userName",r.form.userName),s.append("userPassword",r.form.userPassword),s.append("userPhone",r.form.userPhone),Object(t.e)(s).then(function(e){200==e.data.code&&(r.$message({type:"success",message:"更新成功!"}),r.getInfo(),r.picMasterVisible=!1,r.form.userDeviceUrl="",r.fileDevice={})}).catch(function(e){r.$message({type:"error",message:"操作失败!"})})}})}}},i={render:function(){var e=this,r=e.$createElement,s=e._self._c||r;return s("div",{staticClass:"wrap"},[s("div",{staticClass:"table_box"},[s("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[s("el-breadcrumb-item",{attrs:{to:{path:"/personalCenter"}}},[e._v("个人信息")]),e._v(" "),s("el-breadcrumb-item",[e._v("修改个人信息")])],1),e._v(" "),s("el-form",{ref:"form",staticClass:"formclass",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"我的头像"}},[s("el-upload",{staticClass:"headPic headImg",attrs:{action:"api/blade-project/project/projectfiles/uploadFiles","auto-upload":!1,limit:1,"list-type":"picture-card","file-list":e.fileList,accept:".jpg,.png,.jpeg,JPG,JPEG","on-change":e.beforePicUpload,"on-remove":e.handlePicRemove}},[s("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),s("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[s("el-input",{model:{value:e.form.userName,callback:function(r){e.$set(e.form,"userName",r)},expression:"form.userName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"手机号",prop:"userPhone"}},[s("el-input",{model:{value:e.form.userPhone,callback:function(r){e.$set(e.form,"userPhone",r)},expression:"form.userPhone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"当前密码",prop:"userPassword"}},[s("el-input",{model:{value:e.form.userPassword,callback:function(r){e.$set(e.form,"userPassword",r)},expression:"form.userPassword"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"设备软件包",prop:"userDeviceVersion"}},[s("div",{on:{click:e.changePack}},[s("span",[e._v(e._s(e.form.userDeviceVersion))]),e._v(" "),s("span",{staticClass:"el-icon-s-goods",staticStyle:{"font-size":"20px"}})])]),e._v(" "),s("el-form-item",{attrs:{label:"我的分组"}},[s("div",{staticClass:"mygroup"},[s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入需要添加的分组"},model:{value:e.mygroup,callback:function(r){e.mygroup=r},expression:"mygroup"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-plus"},nativeOn:{click:function(r){return e.addGroup(r)}},slot:"append"})],1),e._v(" "),s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"可输入分组进行搜索",clearable:""},model:{value:e.searchVal,callback:function(r){e.searchVal=r},expression:"searchVal"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchGroup},slot:"append"})],1)],1),e._v(" "),s("div",{staticClass:"groupList"},e._l(e.groupList,function(r,t){return s("div",{key:t,staticClass:"item"},[999!=r.group.groupId?s("el-input",{on:{blur:function(s){return e.inputBlur(r.group)}},model:{value:r.group.groupName,callback:function(s){e.$set(r.group,"groupName",s)},expression:"item.group.groupName"}},[s("template",{slot:"append"},[e._v("("+e._s(r.total)+")")])],2):s("el-input",{attrs:{readonly:"readonly"},model:{value:r.group.groupName,callback:function(s){e.$set(r.group,"groupName",s)},expression:"item.group.groupName"}},[s("template",{slot:"append"},[e._v("("+e._s(r.total)+")")])],2),e._v(" "),999!=r.group.groupId?s("span",{staticClass:"del el-icon-remove",on:{click:function(s){return e.delGroup(r.group.groupId)}}}):e._e()],1)}),0),e._v(" "),s("el-form-item",[s("el-button",{on:{click:function(r){return e.editCancle(2)}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.submitPicForm("form")}}},[e._v("确定")])],1)],1)],1),e._v(" "),s("el-drawer",{attrs:{title:"上传软件包",visible:e.picMasterVisible,direction:"rtl","before-close":e.beforeCloseDrawer,wrapperClosable:!1,size:"50%"},on:{"update:visible":function(r){e.picMasterVisible=r}}},[s("el-form",{ref:"form_device",staticClass:"formclass deviceClass",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"软件版本号",prop:"userDeviceVersion"}},[s("el-input",{model:{value:e.form.userDeviceVersion,callback:function(r){e.$set(e.form,"userDeviceVersion",r)},expression:"form.userDeviceVersion"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"选择软件包",prop:"userDeviceUrl"}},[s("el-upload",{staticClass:"headPic",attrs:{action:"sqfc/user/updateDevice","auto-upload":!1,limit:1,"file-list":e.fileDeviceList,"on-change":e.beforeDeviceUpload,"on-remove":e.handleDeviceRemove}},[s("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),e._v(" "),s("el-form-item",[s("el-button",{on:{click:function(r){return e.editCancle(1)}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.save("form_device")}}},[e._v("保存")])],1)],1)],1)],1)])},staticRenderFns:[]};var a=s("VU/8")(o,i,!1,function(e){s("scIH")},"data-v-7d254f45",null);r.default=a.exports},scIH:function(e,r){}});
//# sourceMappingURL=11.7beadbac632c776117cf.js.map